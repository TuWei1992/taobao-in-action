package com.dream.message.controller;

import com.dream.Constants;
import com.taobao.api.internal.tmc.Message;
import com.taobao.api.internal.tmc.MessageHandler;
import com.taobao.api.internal.tmc.MessageStatus;
import com.taobao.api.internal.tmc.TmcClient;
import com.taobao.top.link.LinkException;

public class TmcClientServer {
	private TmcClient client;
	public void init() throws LinkException{
		client = new TmcClient(Constants.APP_KEY, Constants.APP_SECRET,"default");
		client.setMessageHandler(new MessageHandler() {  
		    public void onMessage(Message message, MessageStatus status) {  
		        try {  
		            System.out.println(message.getContent());  
		            System.out.println(message.getTopic());
		            // 默认不抛出异常则认为消息处理成功  
		        } catch (Exception e) {  
		            e.printStackTrace();  
		            status.fail();// 消息处理失败回滚，服务端需要重发  
		        }  
		    }

		});  
		client.connect("ws://mc.api.tbsandbox.com/");
	}
	
	public void destroy(){
		client.close();
		client = null;
	}

}
