/*******************************************************************************
 * Copyright (c) 2005, 2014 com.dream
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 *******************************************************************************/
package com.dream.item.controller;


import java.text.SimpleDateFormat;
import java.util.Date;

import javax.servlet.ServletException;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

import com.taobao.api.DefaultTaobaoClient;
import com.taobao.api.TaobaoClient;
import com.taobao.api.request.ItemsOnsaleGetRequest;
import com.taobao.api.response.ItemsOnsaleGetResponse;

/**
 * ItemController负责打开商品列表和商品详情页面，
 * 
 * 
 * 
 * @author Frank
 */
@Controller
@RequestMapping(value = "/item")
public class ItemController {
	

	@RequestMapping(value = "list",method = RequestMethod.GET)
	public String list(@RequestParam(value = "id", defaultValue = "-1") String code) throws Exception {
		
		TaobaoClient client=new DefaultTaobaoClient("https://gw.api.tbsandbox.com/router/rest", "1021697746", "sandbox18b7c5cc19a602a635ebb8bcd");
		ItemsOnsaleGetRequest req=new ItemsOnsaleGetRequest();
		req.setFields("num_iid,title,price");
		req.setQ("N97");
		req.setCid(1512L);
		req.setSellerCids("11");
		req.setPageNo(10L);
		req.setHasDiscount(true);
		req.setHasShowcase(true);
		req.setOrderBy("list_time:desc");
		req.setIsTaobao(true);
		req.setIsEx(true);
		req.setPageSize(100L);
		Date dateTime = SimpleDateFormat.getDateTimeInstance().parse("2000-01-01 00:00:00");
		req.setStartModified(dateTime);
		Date dateTime1 = SimpleDateFormat.getDateTimeInstance().parse("2000-01-01 00:00:00");
		req.setEndModified(dateTime1);
		req.setIsCspu(true);
		
		String sessionKey = code;
		ItemsOnsaleGetResponse response = client.execute(req , sessionKey);
		
		if(!response.isSuccess())
		{	
			throw new ServletException("Error");
		}
		
		
		return "item/list";
	}
	
	@RequestMapping(value = "detail/{id}",method = RequestMethod.GET)
	public String detail(@RequestParam(value = "id", defaultValue = "-1") Long itemId) {
		return "item/detail";
	}

}
